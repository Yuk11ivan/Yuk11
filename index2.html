<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¶åŒºè½¬æ¢è®¡ç®—å™¨</title>
    <style>
        /* åŸºç¡€æ ·å¼å˜é‡ */
        :root {
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            --border-color: #e0e0e0;
            --accent-color: #4285f4;
            --accent-hover: #3367d6;
            --result-bg: #f0f7ff;
            --result-border: #e1f0fe;
            --history-bg: #f9f9f9;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-primary: #f0f0f0;
            --text-secondary: #b8b8b8;
            --text-tertiary: #888888;
            --border-color: #333f58;
            --accent-color: #4da6ff;
            --accent-hover: #3a89e9;
            --result-bg: #1e3163;
            --result-border: #2a4380;
            --history-bg: #1a2947;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            transition: var(--transition);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 30px 20px;
            transition: var(--transition);
        }

        /* æ ‡é¢˜åŒºæ ·å¼ */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--text-primary);
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.5px;
            flex: 1;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 20px;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            color: var(--accent-color);
            transform: rotate(30deg);
        }

        .time-display {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        /* è½¬æ¢æ ¸å¿ƒåŒºæ ·å¼ */
        .converter {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .timezone-block {
            flex: 1;
            min-width: 280px;
            background: var(--history-bg);
            border-radius: 8px;
            padding: 20px;
            transition: var(--transition);
            position: relative;
        }

        .timezone-block:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .timezone-block label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }

        select, input {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 18px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 15px;
            background-color: var(--card-bg);
            color: var(--text-primary);
            transition: var(--transition);
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }

        #result {
            background: var(--result-bg);
            border: 1px solid var(--result-border);
            padding: 14px 15px;
            border-radius: 6px;
            min-height: 46px;
            display: flex;
            align-items: center;
            color: var(--text-primary);
            font-size: 15px;
            transition: var(--transition);
        }

        #swap-btn {
            padding: 12px 20px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 20px;
            transition: var(--transition);
            margin: 0 10px;
        }

        #swap-btn:hover {
            background: var(--accent-hover);
            transform: scale(1.05);
        }

        #swap-btn:active {
            transform: scale(0.98);
        }

        /* æ ¼å¼é€‰æ‹©å™¨ */
        .format-options {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .format-option {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }

        .format-option:hover {
            border-color: var(--accent-color);
        }

        .format-option.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        /* å†å²è®°å½•åŒºåŸŸ */
        .history-section {
            margin-top: 40px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-title {
            font-size: 18px;
            color: var(--text-primary);
        }

        .clear-history {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }

        .clear-history:hover {
            color: #e74c3c;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            border-top: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .history-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
            color: var(--text-secondary);
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:hover {
            background-color: rgba(66, 133, 244, 0.05);
        }

        .history-item .timestamp {
            color: var(--text-tertiary);
            font-size: 12px;
        }

        /* åº•éƒ¨æ ·å¼ */
        .footer {
            color: var(--text-tertiary);
            font-size: 12px;
            text-align: center;
            margin-top: 40px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            transition: var(--transition);
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .converter {
                flex-direction: column;
            }

            #swap-btn {
                rotate: 90deg;
                margin: 10px 0;
            }

            .timezone-block {
                width: 100%;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .history-item {
            animation: fadeIn 0.3s ease;
        }

        #result {
            transition: all 0.3s ease;
        }

        #result.update {
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(66, 133, 244, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(66, 133, 244, 0); }
            100% { box-shadow: 0 0 0 0 rgba(66, 133, 244, 0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ ‡é¢˜åŒº -->
        <div class="header">
            <h1>æ—¶åŒºè½¬æ¢è®¡ç®—å™¨</h1>
            <button id="theme-toggle" class="theme-toggle">ğŸŒ™</button>
        </div>
        <div class="time-display" id="local-time">å½“å‰ç³»ç»Ÿæ—¶é—´ï¼šåŠ è½½ä¸­...</div>

        <!-- æ ¼å¼é€‰æ‹©å™¨ -->
        <div class="format-options">
            <div class="format-option active" data-format="default">é»˜è®¤æ ¼å¼ (YYYY-MM-DD HH:MM)</div>
            <div class="format-option" data-format="full">å®Œæ•´æ ¼å¼ (å‘¨å‡  æœˆ æ—¥ å¹´ HH:MM)</div>
            <div class="format-option" data-format="24h">24å°æ—¶åˆ¶ (HH:MM DD/MM/YYYY)</div>
            <div class="format-option" data-format="12h">12å°æ—¶åˆ¶ (hh:MM AM/PM MM/DD/YYYY)</div>
        </div>

        <!-- è½¬æ¢æ ¸å¿ƒåŒº -->
        <div class="converter">
            <!-- æºæ—¶åŒºæ¨¡å— -->
            <div class="timezone-block">
                <label>æºæ—¶åŒº</label>
                <select id="source-tz"></select>
                <label>æºæ—¶é—´ï¼ˆæ ¼å¼ï¼šYYYY-MM-DD HH:MMï¼‰</label>
                <input type="datetime-local" id="source-time" step="60">
            </div>

            <!-- äº¤æ¢æŒ‰é’® -->
            <button id="swap-btn">â‡„ äº¤æ¢æ—¶åŒº</button>

            <!-- ç›®æ ‡æ—¶åŒºæ¨¡å— -->
            <div class="timezone-block">
                <label>ç›®æ ‡æ—¶åŒº</label>
                <select id="target-tz"></select>
                <label>è½¬æ¢ç»“æœ</label>
                <div id="result">è¯·é€‰æ‹©æ—¶åŒºå¹¶è¾“å…¥æ—¶é—´</div>
            </div>
        </div>

        <!-- å†å²è®°å½•åŒºåŸŸ -->
        <div class="history-section">
            <div class="history-header">
                <div class="history-title">è½¬æ¢å†å²</div>
                <button id="clear-history" class="clear-history">æ¸…é™¤è®°å½•</button>
            </div>
            <div id="history-list" class="history-list">
                <!-- å†å²è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- åº•éƒ¨æç¤º -->
        <div class="footer">
            æ•°æ®åŸºäºæµè§ˆå™¨æ—¶åŒºåº“ï¼Œè‡ªåŠ¨å¤„ç†å¤ä»¤æ—¶ | å¢å¼ºç‰ˆ
        </div>
    </div>

    <script>
        // 1. å®šä¹‰æ”¯æŒçš„æ—¶åŒºåˆ—è¡¨ï¼ˆ30ä¸ªä¸»æµæ—¶åŒºï¼‰
        const timezones = [
            { name: "åŒ—äº¬ - ä¸­å›½", value: "Asia/Shanghai" },
            { name: "é¦™æ¸¯ - ä¸­å›½", value: "Asia/Hong_Kong" },
            { name: "å°åŒ— - ä¸­å›½å°æ¹¾", value: "Asia/Taipei" },
            { name: "çº½çº¦ - ç¾å›½", value: "America/New_York" },
            { name: "æ´›æ‰çŸ¶ - ç¾å›½", value: "America/Los_Angeles" },
            { name: "èŠåŠ å“¥ - ç¾å›½", value: "America/Chicago" },
            { name: "ä¼¦æ•¦ - è‹±å›½", value: "Europe/London" },
            { name: "å·´é» - æ³•å›½", value: "Europe/Paris" },
            { name: "æŸæ— - å¾·å›½", value: "Europe/Berlin" },
            { name: "ä¸œäº¬ - æ—¥æœ¬", value: "Asia/Tokyo" },
            { name: "æ‚‰å°¼ - æ¾³å¤§åˆ©äºš", value: "Australia/Sydney" },
            { name: "æ–°åŠ å¡ - æ–°åŠ å¡", value: "Asia/Singapore" },
            { name: "é¦–å°” - éŸ©å›½", value: "Asia/Seoul" },
            { name: "è«æ–¯ç§‘ - ä¿„ç½—æ–¯", value: "Europe/Moscow" },
            { name: "è¿ªæ‹œ - é˜¿è”é…‹", value: "Asia/Dubai" },
            { name: "æ–°å¾·é‡Œ - å°åº¦", value: "Asia/Kolkata" },
            { name: "æ›¼è°· - æ³°å›½", value: "Asia/Bangkok" },
            { name: "å‰éš†å¡ - é©¬æ¥è¥¿äºš", value: "Asia/Kuala_Lumpur" },
            { name: "æ¸©å“¥å - åŠ æ‹¿å¤§", value: "America/Vancouver" },
            { name: "å¤šä¼¦å¤š - åŠ æ‹¿å¤§", value: "America/Toronto" },
            { name: "é‡Œçº¦çƒ­å†…å¢ - å·´è¥¿", value: "America/Rio_de_Janeiro" },
            { name: "çº¦ç¿°å†…æ–¯å ¡ - å—é", value: "Africa/Johannesburg" },
            { name: "ä¼Šæ–¯å¦å¸ƒå°” - åœŸè€³å…¶", value: "Europe/Istanbul" },
            { name: "å¼€ç½— - åŸƒåŠ", value: "Africa/Cairo" },
            { name: "å¢¨è¥¿å“¥åŸ - å¢¨è¥¿å“¥", value: "America/Mexico_City" },
            { name: "å¥¥å…‹å…° - æ–°è¥¿å…°", value: "Pacific/Auckland" },
            { name: "é©¬å¾·é‡Œ - è¥¿ç­ç‰™", value: "Europe/Madrid" },
            { name: "ç½—é©¬ - æ„å¤§åˆ©", value: "Europe/Rome" },
            { name: "æ³•å…°å…‹ç¦ - å¾·å›½", value: "Europe/Frankfurt" },
            { name: "æ—§é‡‘å±± - ç¾å›½", value: "America/San_Francisco" }
        ];

        // å­˜å‚¨å½“å‰é€‰æ‹©çš„æ—¶é—´æ ¼å¼
        let currentFormat = 'default';
        
        // 2. åˆå§‹åŒ–é¡µé¢
        function init() {
            // å¡«å……æ—¶åŒºé€‰æ‹©æ¡†
            const sourceSelect = document.getElementById('source-tz');
            const targetSelect = document.getElementById('target-tz');
            
            timezones.forEach(tz => {
                const option = document.createElement('option');
                option.value = tz.value;
                option.textContent = tz.name;
                sourceSelect.appendChild(option.cloneNode(true));
                targetSelect.appendChild(option);
            });

            // é»˜è®¤é€‰æ‹©ï¼šæºæ—¶åŒº=åŒ—äº¬ï¼Œç›®æ ‡æ—¶åŒº=çº½çº¦
            sourceSelect.value = "Asia/Shanghai";
            targetSelect.value = "America/New_York";

            // è®¾ç½®å½“å‰æ—¶é—´ä¸ºé»˜è®¤è¾“å…¥
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 16); // æ ¼å¼ï¼šYYYY-MM-DDTHH:MM
            document.getElementById('source-time').value = dateStr;

            // æ˜¾ç¤ºæœ¬åœ°ç³»ç»Ÿæ—¶é—´
            updateLocalTime();
            setInterval(updateLocalTime, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡

            // åŠ è½½å†å²è®°å½•
            loadHistory();

            // ç»‘å®šäº‹ä»¶
            document.getElementById('source-tz').addEventListener('change', calculateTime);
            document.getElementById('target-tz').addEventListener('change', calculateTime);
            document.getElementById('source-time').addEventListener('input', calculateTime);
            document.getElementById('swap-btn').addEventListener('click', swapTimezones);
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            document.getElementById('clear-history').addEventListener('click', clearHistory);
            
            // ç»‘å®šæ ¼å¼é€‰æ‹©äº‹ä»¶
            document.querySelectorAll('.format-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.format-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    currentFormat = this.dataset.format;
                    calculateTime(); // é‡æ–°è®¡ç®—ä»¥åº”ç”¨æ–°æ ¼å¼
                });
            });

            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„ä¸»é¢˜è®¾ç½®
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').textContent = 'â˜€ï¸';
            }

            // åˆå§‹è®¡ç®—ä¸€æ¬¡
            calculateTime();
        }

        // 3. æ›´æ–°æœ¬åœ°ç³»ç»Ÿæ—¶é—´æ˜¾ç¤º
        function updateLocalTime() {
            const now = new Date();
            const options = { 
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                hour12: false 
            };
            document.getElementById('local-time').textContent = `å½“å‰ç³»ç»Ÿæ—¶é—´ï¼š${now.toLocaleString('zh-CN', options)}`;
        }

        // 4. æ ¸å¿ƒï¼šè®¡ç®—æ—¶åŒºè½¬æ¢ç»“æœ
        function calculateTime() {
            const sourceTz = document.getElementById('source-tz').value;
            const targetTz = document.getElementById('target-tz').value;
            const sourceTimeStr = document.getElementById('source-time').value;

            if (!sourceTimeStr) {
                document.getElementById('result').textContent = "è¯·è¾“å…¥æºæ—¶é—´";
                return;
            }

            // è½¬æ¢è¾“å…¥æ—¶é—´ä¸ºDateå¯¹è±¡ï¼ˆå¤„ç†æ—¶åŒºï¼‰
            const sourceTime = new Date(sourceTimeStr);
            if (isNaN(sourceTime.getTime())) {
                document.getElementById('result').textContent = "æ—¶é—´æ ¼å¼é”™è¯¯";
                return;
            }

            // æ ¹æ®é€‰æ‹©çš„æ ¼å¼è·å–ä¸åŒçš„é€‰é¡¹
            let targetOptions;
            switch(currentFormat) {
                case 'full':
                    targetOptions = {
                        weekday: 'long', month: 'long', day: 'numeric', year: 'numeric',
                        hour: '2-digit', minute: '2-digit',
                        hour12: false,
                        timeZone: targetTz
                    };
                    break;
                case '24h':
                    targetOptions = {
                        hour: '2-digit', minute: '2-digit',
                        day: '2-digit', month: '2-digit', year: 'numeric',
                        hour12: false,
                        timeZone: targetTz,
                        year: 'numeric'
                    };
                    break;
                case '12h':
                    targetOptions = {
                        hour: '2-digit', minute: '2-digit',
                        day: '2-digit', month: '2-digit', year: 'numeric',
                        hour12: true,
                        timeZone: targetTz
                    };
                    break;
                default: // default
                    targetOptions = {
                        year: 'numeric', month: '2-digit', day: '2-digit',
                        hour: '2-digit', minute: '2-digit',
                        hour12: false,
                        timeZone: targetTz
                    };
            }

            const sourceOptions = {
                timeZone: sourceTz,
                year: 'numeric', month: '2-digit', day: '2-digit'
            };

            // è·å–æºæ—¶åŒºå’Œç›®æ ‡æ—¶åŒºçš„åç§°
            const sourceTzName = timezones.find(tz => tz.value === sourceTz)?.name || sourceTz;
            const targetTzName = timezones.find(tz => tz.value === targetTz)?.name || targetTz;

            // æ ¼å¼åŒ–ç›®æ ‡æ—¶åŒºæ—¶é—´
            const targetTimeStr = sourceTime.toLocaleString('zh-CN', targetOptions);
            const sourceDate = sourceTime.toLocaleDateString('zh-CN', sourceOptions);
            const targetDate = sourceTime.toLocaleDateString('zh-CN', { ...sourceOptions, timeZone: targetTz });

            // è®¡ç®—æ—¶å·®å’Œè·¨å¤©
            const sourceOffset = new Date(sourceTime.toLocaleString('en-US', { timeZone: sourceTz })).getTimezoneOffset();
            const targetOffset = new Date(sourceTime.toLocaleString('en-US', { timeZone: targetTz })).getTimezoneOffset();
            const hourDiff = (sourceOffset - targetOffset) / 60; // æ—¶å·®ï¼ˆå°æ—¶ï¼‰
            
            let dayDiffText = '';
            if (sourceDate !== targetDate) {
                dayDiffText = hourDiff > 0 ? `+${Math.floor(hourDiff / 24) + 1}å¤©` : `-${Math.floor(Math.abs(hourDiff) / 24) + 1}å¤©`;
            }

            // æ˜¾ç¤ºç»“æœå¹¶æ·»åŠ åŠ¨ç”»æ•ˆæœ
            const resultElement = document.getElementById('result');
            const resultText = `${targetTimeStr} ï¼ˆ${hourDiff >= 0 ? '+' : ''}${hourDiff}å°æ—¶ ${dayDiffText}`.trim() + 'ï¼‰';
            resultElement.textContent = resultText;
            resultElement.classList.add('update');
            setTimeout(() => resultElement.classList.remove('update'), 500);

            // ä¿å­˜åˆ°å†å²è®°å½•
            saveToHistory({
                sourceTz: sourceTzName,
                targetTz: targetTzName,
                sourceTime: sourceTime.toLocaleString('zh-CN'),
                targetTime: targetTimeStr,
                timestamp: new Date().toISOString()
            });
        }

        // 5. äº¤æ¢æ—¶åŒºåŠŸèƒ½
        function swapTimezones() {
            const sourceSelect = document.getElementById('source-tz');
            const targetSelect = document.getElementById('target-tz');
            
            // äº¤æ¢é€‰ä¸­å€¼
            const temp = sourceSelect.value;
            sourceSelect.value = targetSelect.value;
            targetSelect.value = temp;
            
            // é‡æ–°è®¡ç®—
            calculateTime();
        }

        // 6. åˆ‡æ¢æ·±è‰²/æµ…è‰²æ¨¡å¼
        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark-mode');
            const themeIcon = document.getElementById('theme-toggle');
            themeIcon.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('darkMode', isDark);
        }

        // 7. ä¿å­˜åˆ°å†å²è®°å½•
        function saveToHistory(item) {
            let history = JSON.parse(localStorage.getItem('timezoneHistory') || '[]');
            
            // é™åˆ¶å†å²è®°å½•æ•°é‡ä¸º10æ¡
            if (history.length >= 10) {
                history.pop(); // ç§»é™¤æœ€æ—©çš„è®°å½•
            }
            
            // æ·»åŠ æ–°è®°å½•åˆ°å¼€å¤´
            history.unshift(item);
            localStorage.setItem('timezoneHistory', JSON.stringify(history));
            
            // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
            loadHistory();
        }

        // 8. åŠ è½½å†å²è®°å½•
        function loadHistory() {
            const historyList = document.getElementById('history-list');
            const history = JSON.parse(localStorage.getItem('timezoneHistory') || '[]');
            
            if (history.length === 0) {
                historyList.innerHTML = '<div class="history-item">æš‚æ— è½¬æ¢è®°å½•</div>';
                return;
            }
            
            historyList.innerHTML = '';
            
            history.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                // æ ¼å¼åŒ–æ—¶é—´æˆ³
                const timestamp = new Date(item.timestamp);
                const timeStr = timestamp.toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                historyItem.innerHTML = `
                    <div>
                        ${item.sourceTime} (${item.sourceTz}) â†’ ${item.targetTime} (${item.targetTz})
                    </div>
                    <div class="timestamp">${timeStr}</div>
                `;
                
                historyList.appendChild(historyItem);
            });
        }

        // 9. æ¸…é™¤å†å²è®°å½•
        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰è½¬æ¢å†å²å—ï¼Ÿ')) {
                localStorage.removeItem('timezoneHistory');
                loadHistory();
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>
